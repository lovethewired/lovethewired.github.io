{"pageProps":{"postData":{"slug":["unpublished","arbitrum","stylus-2-test"],"contentRaw":"\n# Testing\n\n## Prover: Stylus\n\nThe native interpreter for Stylus programs is located in `arbitrator/stylus`. The main Rust struct that handles execution is `NativeInstance` located in `arbitrator/stylus/src/native.rs`.\n\n```rust arbitrator/stylus/src/native.rs\npub struct NativeInstance<D: DataReader, E: EvmApi<D>> {\n    pub instance: Instance,\n    pub store: Store,\n    pub env: FunctionEnv<WasmEnv<D, E>>,\n}\n```\n\nGenerics:\n\n- `DataReader` trait: Handles copying data from Go to Rust (in normal execution).\n- `EvmApi` trait: Handles communication from the WASM program to the EVM environment.\n\nStruct fields:\n\n- `instance`: A wasmer execution runtime instance.\n- `store`: All parameters that are modifiable by a WASM program.\n- `env`: A wasmer function environment.\n\nIn native execution, when a user program is loaded from storage and called, a `NativeInstance` is created first. After creating the instance, the program can be run by calling `instance.run_main`.\n\n`run_main` is executed with `args` (bytes slice), `config` (`version`, `max_depth`, `pricing`) and the `ink` amount available to the program.\n\nAfter con\n\n```rust https://github.com/OffchainLabs/stylus/blob/5dd3050506d4dd12d5c7bdc7c42f7f26ddf62c25/arbitrator/stylus/src/run.rs#L67-L123\nimpl<D: DataReader, E: EvmApi<D>> RunProgram for NativeInstance<D, E> {\n    fn run_main(&mut self, args: &[u8], config: StylusConfig, ink: u64) -> Result<UserOutcome> {\n        use UserOutcome::*;\n\n        // Configure global variables.\n        self.set_ink(ink);\n        self.set_stack(config.max_depth);\n\n        // ...\n\n        // Run main.\n        let status = match main.call(store, args.len() as u32) {\n            // ...\n        };\n\n        // ...\n\n        // Return result.\n        let outs = env.outs.clone();\n        Ok(match status {\n            0 => UserOutcome::Success(outs),\n            _ => UserOutcome::Revert(outs),\n        })\n    }\n}\n```\n","title":"First steps to running Arbitrum Stylus","date":"May 1, 2024","suptitle":"An auditor's guide to Arbitrum Stylus"}},"__N_SSG":true}