<!DOCTYPE html><html><head><meta charSet="utf-8"/><title class="animate__fadeIn">0xPhaze</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/c857aa62c4b06e03.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c857aa62c4b06e03.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-ede13cf31a63337e.js" defer=""></script><script src="/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/_next/static/chunks/main-914fbfab4f90b52f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-739d687a4044c19c.js" defer=""></script><script src="/_next/static/chunks/905-42611feb98bcbc7d.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-7eff0f7d4de07ef5.js" defer=""></script><script src="/_next/static/uBpuurCB8y0QEvVtUdSU4/_buildManifest.js" defer=""></script><script src="/_next/static/uBpuurCB8y0QEvVtUdSU4/_ssgManifest.js" defer=""></script><script src="/_next/static/uBpuurCB8y0QEvVtUdSU4/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="app px-4 pb-20 min-h-screen flex flex-col items-center w-full max-w-screen"><header class="w-full flex flex-col px-4 sm:px-8 md:px-12 max-w-5xl sm:flex-row justify-between items-center border-white/20 overflow-hidden border-b p-4 h-16"><div class="w-full h-full flex flex-col sm:flex-row justify-start sm:justify-between items-center gap-y-4 overflow-hidden sm:overflow-visible"><div class="flex w-full sm:w-fit items-center"><h1 class="text-xl mx-auto font-display"><a href="/">0xPhaze</a></h1><div class="my-auto -ml-6 w-6 sm:hidden"><div class="text-slate-300 hover:text-secondary-400 transition-colors duration-200 cursor-pointer h-6"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"></path></svg></div></div></div><div class="flex flex-col sm:flex-row gap-x-8 md:gap-x-10 gap-y-4"><div class="flex gap-x-2 sm:gap-x-5 items-center justify-evenly"><a target="_blank" rel="noreferrer" class="link" href="https://github.com/willisk/"><div><div class="text-slate-300 hover:text-secondary-400 transition-colors duration-200 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4"><path style="fill:currentColor" d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"></path></svg></div></div></a><a target="_blank" rel="noreferrer" class="link" href="https://twitter.com/lovethewired"><div><div class="text-slate-300 hover:text-secondary-400 transition-colors duration-200 cursor-pointer"><svg viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-4"><path style="fill:currentColor" d="M15.584 1.578a7.91 7.91 0 0 1-1.57 1.807v.482c0 .965-.112 1.929-.336 2.772-.224.965-.673 1.808-1.121 2.652a17.373 17.373 0 0 1-1.794 2.29c-.785.723-1.681 1.205-2.578 1.566-1.01.362-2.13.603-3.252.603-1.793 0-3.475-.603-4.932-1.567h.784c1.458 0 2.915-.482 4.036-1.446a2.914 2.914 0 0 1-1.905-.723c-.561-.482-.897-.964-1.122-1.687h.561c.336 0 .56 0 .897-.12C2.579 8.085 1.907 7.603 1.458 7 .785 6.398.561 5.675.561 4.83c.449.242 1.01.362 1.458.483A5.531 5.531 0 0 1 .898 4.109C.673 3.626.449 3.024.449 2.42c0-.602.112-1.205.449-1.687a8.606 8.606 0 0 0 2.914 2.53c1.122.603 2.355.965 3.7 1.086 0-.241-.112-.483-.112-.844 0-.723.224-1.326.56-1.928.337-.603.897-.965 1.458-1.326.56-.241 1.233-.362 1.906-.12.672.12 1.233.481 1.681.964.673-.121 1.458-.362 2.018-.844-.224.844-.784 1.446-1.457 1.928.785-.12 1.457-.24 2.018-.602Z" fill="#081026"></path></svg></div></div></a><div><div class="text-slate-300 hover:text-secondary-400 transition-colors duration-200 cursor-pointer">ABI</div></div></div><button class="rounded px-4 py-2 uppercase text-white select-none  transition-all duration-300 bg-primary-600 hover:bg-primary-700  !outline-none normal-case text-sm w-[140px] w-36">Connect Wallet</button></div></div></header><main class="gap-y-20 mt-8 py-4 sm:px-8 md:px-12 w-full min-h-[500px] max-w-4xl"><div class="flex flex-col justify-between gap-y-20"><div class="content markdown"><h1 class="text-center">ERC721M</h1><h2 class="text-center">ERC721A for stakers</h2><p class="text-slate-500 text-sm text-center">21 Mar 2022</p><div class="mt-16"><p>Update: Check out <a target="_blank" rel="noreferrer" class="link" href="https://github.com/0xphaze/ERC721M">this repo</a> for an implementation.</p>
<p>We&#x27;ve come a long way since the development on <a target="_blank" rel="noreferrer" class="link" href="https://madmousecircus.io/">MadMouse</a> started back in November.</p>
<p>Initially, our contract was based on <a target="_blank" rel="noreferrer" class="link" href="https://www.erc721a.org/">ERC721A</a>.
While being extremely happy about new form of optimization that is brought to the NFT-space,
we immediately had <a target="_blank" rel="noreferrer" class="link" href="https://github.com/chiru-labs/ERC721A/issues/18">some improvements to make</a>.
However, it quickly became clear, that because of all its features and special needs,
the MadMouse contract would need its own unique implementation.</p>
<p>What we especially noticed was how inneficiently most staking contracts were implemented.
We definitely did not want to follow suit.
The worst thing for us would be if people had to pay
unnecessarily high gas fees when interacting with our contracts.
That&#x27;s why our top priority has always been to
keep the implementation as gas-efficient as possible,
so not to exclude anyone from taking part in our ecosystem.</p>
<p>To be able to fit all of our auxilliary information into the contract
without wasting extra storage slots (which ultimately are the main driver
for gas costs), we decided to pack all information using bitmaps.</p>
<p>This means that while our contract has all this extra functionality,
the storage costs (and thus all basic operation) remain the same as ERC721A&#x27;s.
<strong>In fact, for some operations gas costs are even less.</strong></p>
<p>Staking in batches, for example, occurs by transferring in batches while minimizing storage reads and writes.
There is even the possibility to mint and stake at the same time, drastically reducing costs.
The token data in this case is implicitly stored, just like in ERC721A.</p>
<h3>ERC721M comparisons</h3>
<p>What does all this mean for the end-user?
Let&#x27;s have a look at some gas comparisons.
For starters, here is a comparison with <a target="_blank" rel="noreferrer" class="link" href="https://www.azuki.com/garden">Azuki</a> (the ones behind ERC721A).</p>
<p><img src="/data/blog/2022/madmouse/azuki.png" alt="azuki-comparison"/></p>
<p>ERC721M still holds up to ERC721A. The comparison is based on 5 mints.
For all comparisons we use 100 gwei as a baseline and the first token is pre-minted.</p>
<p>One of ERC721M&#x27;s special features is that it comes with a <strong>&#x27;mint &amp; stake&#x27;</strong> functionality.
Just recently, <a target="_blank" rel="noreferrer" class="link" href="https://metroverse.com/">Metroverse</a> launched, also with the same ability.
Although their contract isn&#x27;t based on ERC721A&#x27;s implicit storage,
their contract is still pretty optimized.</p>
<p><img src="/data/blog/2022/madmouse/metroverse.png" alt="metroverse-comparison"/></p>
<p>Again, the data is based on a mint quantity of 5. We see that ERC721M extends the idea
of ERC721A to allow direct staking without any overhead cost.
<strong>MadMouse&#x27;s &#x27;mint &amp; stake&#x27; is about 5x cheaper than Metroverse</strong>.</p>
<p>We tried hard to find a better comparison and to look for any
implementation that was based on ERC721A and allowed for staking.
In that regard, we found <a target="_blank" rel="noreferrer" class="link" href="https://www.wabisabicollective.io/">WabiSabi</a>,
a collection that just launched this month.</p>
<p><img src="/data/blog/2022/madmouse/wabisabi.png" alt="wabisabi-comparison"/></p>
<p>Here, we showed what it would be like, if we didn&#x27;t use the &#x27;mint &amp; stake&#x27; feature, but
first had minted 5 NFTs and then in-turn staked those.</p>
<p>Staking with ERC721A means that (like with a transfer), implicit token data has to be
explicitly set. That&#x27;s why staking can seem more expensive at first.
However, ERC721M still tries to optimize as much as possible under the hood.
Staking is done similarly to a batch transfer, where state reads and writes are
minimized as much as possible.
<strong>MadMouse is about 4x more efficient than Wabisabi</strong>.
Comparing with the &#x27;mint &amp; stake&#x27; feature, <strong>this turns out to be 8x as cheap</strong>
(not even taking into account the extra approval transaction).</p>
<p>WabiSabi keeps track of staked token ids in a list (as seen with many other
collections as well). Because of this, unstaking gas costs
can quickly explode with higher numbers, due to the worst-case complexity being O(N^2).</p>
<p>If you know of any cheaper staking implementation that we could compare ours against, let us know!</p>
<h3>What&#x27;s next?</h3>
<p>So, what&#x27;s next for MadMouse? Does this become a community-standard?
In its current form, we had to rely on some heavy engineering work
in order to fit in all the features while keeping costs cheap.
Mistakes are likely to happen if not handled with care.</p>
<p>That&#x27;s why our plan is to release a simpler, lighter build in the near future
as an ERC721A extension, so that other projects can also make use of
an efficient staking contract.</p></div></div><div class="soldisc bg-slate-800/40 text-slate-300 -mx-4 px-4 p-4 rounded-xl border border-white/20"><div class="text-lg py-2"><span class="font-display bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">SolDisc</span> <span class="text-sm text-slate-400 ml-1">- On-Chain Discourse</span></div><div><div class="border-y border-white/40 pt-3 mb-4"><p class="text-slate-400 text-sm">Leave a comment:</p><div><div class="mt-2 flex flex-col w-full justify-center mt-2"><span class="text-sm px-1  text-slate-400"></span><div class="flex items-center group border-0 border-white/20 rounded-t-md transition-colors duration-200 w-full rounded-md border-[1px] hover:border-slate-100 focus-within:border-primary-600 focus-within:hover:border-primary-600 focus-within:shadow-[0_8px_12px_-14px_white]"><form class="w-full flex"><input type="text" value="" class="outline-none w-full px-1 my-auto mr-auto bg-transparent placeholder-slate-500 text-ellipsis" autoComplete="off" placeholder="username"/></form></div></div></div><div class="flex justify-center m-4"><button class="rounded px-4 py-2 uppercase text-white select-none  transition-all duration-300 text-primary-600 hover:text-primary-100">Connect to Rinkeby</button></div></div><p class="text-center my-8">No Comments yet</p><div class="flex flex-col gap-y-4"></div></div></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"slug":["2022","madmouse"],"contentRaw":"\nUpdate: Check out [this repo](https://github.com/0xphaze/ERC721M) for an implementation.\n\nWe've come a long way since the development on [MadMouse](https://madmousecircus.io/) started back in November.\n\nInitially, our contract was based on [ERC721A](https://www.erc721a.org/).\nWhile being extremely happy about new form of optimization that is brought to the NFT-space,\nwe immediately had [some improvements to make](https://github.com/chiru-labs/ERC721A/issues/18).\nHowever, it quickly became clear, that because of all its features and special needs,\nthe MadMouse contract would need its own unique implementation.\n\nWhat we especially noticed was how inneficiently most staking contracts were implemented.\nWe definitely did not want to follow suit.\nThe worst thing for us would be if people had to pay\nunnecessarily high gas fees when interacting with our contracts.\nThat's why our top priority has always been to\nkeep the implementation as gas-efficient as possible,\nso not to exclude anyone from taking part in our ecosystem.\n\nTo be able to fit all of our auxilliary information into the contract\nwithout wasting extra storage slots (which ultimately are the main driver\nfor gas costs), we decided to pack all information using bitmaps.\n\nThis means that while our contract has all this extra functionality,\nthe storage costs (and thus all basic operation) remain the same as ERC721A's.\n**In fact, for some operations gas costs are even less.**\n\nStaking in batches, for example, occurs by transferring in batches while minimizing storage reads and writes.\nThere is even the possibility to mint and stake at the same time, drastically reducing costs.\nThe token data in this case is implicitly stored, just like in ERC721A.\n\n## ERC721M comparisons\n\nWhat does all this mean for the end-user?\nLet's have a look at some gas comparisons.\nFor starters, here is a comparison with [Azuki](https://www.azuki.com/garden) (the ones behind ERC721A).\n\n![azuki-comparison](/data/blog/2022/madmouse/azuki.png)\n\nERC721M still holds up to ERC721A. The comparison is based on 5 mints.\nFor all comparisons we use 100 gwei as a baseline and the first token is pre-minted.\n\nOne of ERC721M's special features is that it comes with a **'mint \u0026 stake'** functionality.\nJust recently, [Metroverse](https://metroverse.com/) launched, also with the same ability.\nAlthough their contract isn't based on ERC721A's implicit storage,\ntheir contract is still pretty optimized.\n\n![metroverse-comparison](/data/blog/2022/madmouse/metroverse.png)\n\nAgain, the data is based on a mint quantity of 5. We see that ERC721M extends the idea\nof ERC721A to allow direct staking without any overhead cost.\n**MadMouse's 'mint \u0026 stake' is about 5x cheaper than Metroverse**.\n\nWe tried hard to find a better comparison and to look for any\nimplementation that was based on ERC721A and allowed for staking.\nIn that regard, we found [WabiSabi](https://www.wabisabicollective.io/),\na collection that just launched this month.\n\n![wabisabi-comparison](/data/blog/2022/madmouse/wabisabi.png)\n\nHere, we showed what it would be like, if we didn't use the 'mint \u0026 stake' feature, but\nfirst had minted 5 NFTs and then in-turn staked those.\n\nStaking with ERC721A means that (like with a transfer), implicit token data has to be\nexplicitly set. That's why staking can seem more expensive at first.\nHowever, ERC721M still tries to optimize as much as possible under the hood.\nStaking is done similarly to a batch transfer, where state reads and writes are\nminimized as much as possible.\n**MadMouse is about 4x more efficient than Wabisabi**.\nComparing with the 'mint \u0026 stake' feature, **this turns out to be 8x as cheap**\n(not even taking into account the extra approval transaction).\n\nWabiSabi keeps track of staked token ids in a list (as seen with many other\ncollections as well). Because of this, unstaking gas costs\ncan quickly explode with higher numbers, due to the worst-case complexity being O(N^2).\n\nIf you know of any cheaper staking implementation that we could compare ours against, let us know!\n\n## What's next?\n\nSo, what's next for MadMouse? Does this become a community-standard?\nIn its current form, we had to rely on some heavy engineering work\nin order to fit in all the features while keeping costs cheap.\nMistakes are likely to happen if not handled with care.\n\nThat's why our plan is to release a simpler, lighter build in the near future\nas an ERC721A extension, so that other projects can also make use of\nan efficient staking contract.\n","title":"ERC721M","suptitle":"ERC721A for stakers","date":"21 Mar 2022","excerpt":"The development on MadMouse began back in November. Our goal was to include a bunch of features alongside staking without compromising on gas costs."}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["2022","madmouse"]},"buildId":"uBpuurCB8y0QEvVtUdSU4","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>