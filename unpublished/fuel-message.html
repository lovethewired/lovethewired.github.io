<!DOCTYPE html><html><head><meta charSet="utf-8"/><title class="animate__fadeIn">0xPhaze</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="next-head-count" content="3"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/23a2b3bc93956487.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/23a2b3bc93956487.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/5b6964bdff897f88.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/5b6964bdff897f88.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-dcf4136cb4ed4a3e.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-10fac88913917d91.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-f2a13320fa311176.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-d2563c831d8a01f7.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/5423ad26-9ee507e8c57e7e9a.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/175675d1-b1f16020bd9e4fee.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/264-01fb23d8f50dfdd3.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/%5B...slug%5D-c108991d8dc26594.js" defer="" crossorigin=""></script><script src="/_next/static/AocSisQRIhnO2ZxvvO6f8/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/AocSisQRIhnO2ZxvvO6f8/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="app px-4 pb-20 min-h-screen flex flex-col items-center w-full max-w-screen"><header class="w-full flex flex-col px-4 sm:px-8 md:px-12 max-w-5xl sm:flex-row justify-between items-center border-white/20 overflow-hidden border-b p-4 h-16"><div class="w-full h-full flex flex-col sm:flex-row justify-start sm:justify-between items-center gap-y-4 overflow-hidden sm:overflow-visible"><div class="flex w-full sm:w-fit items-center"><h1 class="text-xl mx-auto font-display"><a href="/">0xPhaze</a></h1><div class="my-auto -ml-6 w-6 sm:hidden"><div class="text-slate-300 hover:text-secondary-400 transition-colors duration-200 cursor-pointer h-6"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"></path></svg></div></div></div><div class="flex flex-col sm:flex-row gap-x-8 md:gap-x-10 gap-y-4"><div class="flex gap-x-2 sm:gap-x-5 items-center justify-evenly"><a target="_blank" rel="noreferrer" class="link" href="https://github.com/0xPhaze/"><div><div class="text-slate-300 hover:text-secondary-400 transition-colors duration-200 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4"><path style="fill:currentColor" d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"></path></svg></div></div></a><a target="_blank" rel="noreferrer" class="link" href="https://twitter.com/lovethewired"><div><div class="text-slate-300 hover:text-secondary-400 transition-colors duration-200 cursor-pointer"><svg viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-4"><path style="fill:currentColor" d="M15.584 1.578a7.91 7.91 0 0 1-1.57 1.807v.482c0 .965-.112 1.929-.336 2.772-.224.965-.673 1.808-1.121 2.652a17.373 17.373 0 0 1-1.794 2.29c-.785.723-1.681 1.205-2.578 1.566-1.01.362-2.13.603-3.252.603-1.793 0-3.475-.603-4.932-1.567h.784c1.458 0 2.915-.482 4.036-1.446a2.914 2.914 0 0 1-1.905-.723c-.561-.482-.897-.964-1.122-1.687h.561c.336 0 .56 0 .897-.12C2.579 8.085 1.907 7.603 1.458 7 .785 6.398.561 5.675.561 4.83c.449.242 1.01.362 1.458.483A5.531 5.531 0 0 1 .898 4.109C.673 3.626.449 3.024.449 2.42c0-.602.112-1.205.449-1.687a8.606 8.606 0 0 0 2.914 2.53c1.122.603 2.355.965 3.7 1.086 0-.241-.112-.483-.112-.844 0-.723.224-1.326.56-1.928.337-.603.897-.965 1.458-1.326.56-.241 1.233-.362 1.906-.12.672.12 1.233.481 1.681.964.673-.121 1.458-.362 2.018-.844-.224.844-.784 1.446-1.457 1.928.785-.12 1.457-.24 2.018-.602Z" fill="#081026"></path></svg></div></div></a><div><div class="text-slate-300 hover:text-secondary-400 transition-colors duration-200 cursor-pointer">ABI</div></div><div><div class="text-slate-300 hover:text-secondary-400 transition-colors duration-200 cursor-pointer">ENC</div></div></div><button class="rounded px-4 py-2 uppercase text-white select-none  transition-all duration-300 disabled:pointer-events-none bg-primary-600 hover:bg-primary-700  !outline-none normal-case text-sm w-[140px] w-36">Connect Wallet</button></div></div></header><main class="gap-y-20 mt-8 py-4 sm:px-8 md:px-12 w-full min-h-[500px] max-w-4xl"><div class="flex flex-col justify-between gap-y-20"><div class="content markdown"><h1 class="text-center">Fuel message portal</h1><p class="text-slate-500 text-sm text-center">Dec 28, 2023</p><div class="mt-16"><ul>
<li><a href="/unpublished/fuel-message#intro">Intro</a></li>
<li><a href="/unpublished/fuel-message#general-token-bridge-design">General Token Bridge Design</a></li>
</ul>
<h2 id="intro"><a href="/unpublished/fuel-message#intro"><span class="icon icon-link"></span></a>Intro</h2>
<p>In XX 2023 we started a review of the Fuel protocol. In particular I was to look at the message portal and the token bridge. For the most part, cross-chain messaging protocols work very similar. The general procedure is that there is a singleton smart contract on the sending chain (Ethereum) dedicated to emitting arbitrary messages. Protocol validators listen to these messages and then broadcasted them to the receiving chain.</p>
<p>The message can be relayed through a smart contract on the receiving chain, but often is also relayed by a very specific address (e.g. the zero address on Polygon) or an aliased address (e.g. Arbitrum, Optimism add a fixed offset to any message sender&#x27;s address).</p>
<p>As transmitting messages is often left very general, the specifics of a cross-chain token bridge require additional logic and validation.</p>
<p>In the case of Fuel</p>
<h2 id="general-token-bridge-design"><a href="/unpublished/fuel-message#general-token-bridge-design"><span class="icon icon-link"></span></a>General Token Bridge Design</h2>
<pre><pre before="" class="" style="-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-wrap:normal;font-family:Menlo, Monaco, &quot;Courier New&quot;, monospace;font-size:14px;color:#76d9e6;text-shadow:none;background:#2a2a2a;padding:15px;border-radius:4px;border:1px solid #e1e1e8;overflow:auto;position:relative"><code style="white-space:pre"><span><span class="token" style="color:#ef3b7d">flowchart</span><span> LR</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    Validators</span><span class="token text" style="color:#e6d06c">([Validators])</span><span>
</span></span><span><span>    Validators </span><span class="token arrow" style="color:#a77afe">-.-&gt;</span><span class="token label property">|relay msg|</span><span> PortalReceiver</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">subgraph</span><span> Fuel
</span></span><span><span>      PortalReceiver </span><span class="token arrow" style="color:#a77afe">-.-&gt;</span><span class="token label property">|call|</span><span> receiver</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">end</span><span>
</span></span><span>
</span><span><span>    User</span><span class="token text" style="color:#e6d06c">([User])</span><span>
</span></span><span><span>    User </span><span class="token arrow" style="color:#a77afe">-.-&gt;</span><span class="token label property">|send tx|</span><span> PortalSender</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">subgraph</span><span> Ethereum
</span></span><span><span>      PortalSender </span><span class="token arrow" style="color:#a77afe">-.-&gt;</span><span class="token label property">|emit msg|</span><span> PortalSender</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">end</span></span></code></pre></pre>
<p>Ignoring other transaction message values such as <code>gas</code>, <code>gasLimit</code>, <code>value</code> and nonce validation.</p>
<pre><pre before="" class="" style="-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-wrap:normal;font-family:Menlo, Monaco, &quot;Courier New&quot;, monospace;font-size:14px;color:#76d9e6;text-shadow:none;background:#2a2a2a;padding:15px;border-radius:4px;border:1px solid #e1e1e8;overflow:auto;position:relative"><code style="white-space:pre"><span><span class="token" style="color:#ef3b7d">classDiagram</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">class</span><span> Message </span><span class="token" style="color:#bebec5">{</span><span>
</span></span><span>        address sender
</span><span>        address receiver
</span><span>        bytes data
</span><span><span>    </span><span class="token" style="color:#bebec5">}</span></span></code></pre></pre>
<p>A token bridge requires extra validation logic to be handled by a <code>TokenBridgeSender</code> and a <code>TokenBridgeReceiver</code> contract.</p>
<pre><pre before="" class="" style="-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-wrap:normal;font-family:Menlo, Monaco, &quot;Courier New&quot;, monospace;font-size:14px;color:#76d9e6;text-shadow:none;background:#2a2a2a;padding:15px;border-radius:4px;border:1px solid #e1e1e8;overflow:auto;position:relative"><code style="white-space:pre"><span><span class="token" style="color:#ef3b7d">flowchart</span><span> LR</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    Validators</span><span class="token text" style="color:#e6d06c">([Validators])</span><span>
</span></span><span><span>    Validators </span><span class="token arrow" style="color:#a77afe">-.-&gt;</span><span class="token label property">|relay msg|</span><span> PortalReceiver</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">subgraph</span><span> Fuel
</span></span><span><span>      PortalReceiver </span><span class="token arrow" style="color:#a77afe">--&gt;</span><span class="token label property">|call|</span><span> TokenBridgeReceiver</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>      TokenBridgeReceiver </span><span class="token arrow" style="color:#a77afe">-.-&gt;</span><span class="token label property">|transfer token|</span><span> receiver</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">end</span><span>
</span></span><span>
</span><span><span>    User</span><span class="token text" style="color:#e6d06c">([User])</span><span>
</span></span><span><span>    User </span><span class="token arrow" style="color:#a77afe">-.-&gt;</span><span class="token label property">|send tx|</span><span> TokenBridgeSender</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">subgraph</span><span> Ethereum
</span></span><span><span>      TokenBridgeSender </span><span class="token arrow" style="color:#a77afe">--&gt;</span><span class="token label property">|call|</span><span> PortalSender</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>      PortalSender </span><span class="token arrow" style="color:#a77afe">-.-&gt;</span><span class="token label property">|emit msg|</span><span> PortalSender</span><span class="token" style="color:#bebec5">;</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">end</span></span></code></pre></pre>
<pre><pre before="" class="" style="-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-wrap:normal;font-family:Menlo, Monaco, &quot;Courier New&quot;, monospace;font-size:14px;color:#76d9e6;text-shadow:none;background:#2a2a2a;padding:15px;border-radius:4px;border:1px solid #e1e1e8;overflow:auto;position:relative"><code style="white-space:pre"><span><span class="token" style="color:#ef3b7d">classDiagram</span><span>
</span></span><span><span>    </span><span class="token" style="color:#ef3b7d">class</span><span> Message </span><span class="token" style="color:#bebec5">{</span><span>
</span></span><span><span>        address sender </span><span class="token" style="color:#a77afe">:</span><span> TokenBridgeSender
</span></span><span><span>        address receiver </span><span class="token" style="color:#a77afe">:</span><span>  TokenBridgeReceiver
</span></span><span><span>        bytes data </span><span class="token" style="color:#a77afe">:</span><span> enc</span><span class="token text" style="color:#e6d06c">(user, receiver, token, value)</span><span>
</span></span><span><span>    </span><span class="token" style="color:#bebec5">}</span></span></code></pre></pre></div></div></div></main></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"postData":{"slug":["unpublished","fuel-message"],"contentRaw":"\n- [Intro](#intro)\n- [General Token Bridge Design](#general-token-bridge-design)\n\n# Intro\n\nIn XX 2023 we started a review of the Fuel protocol. In particular I was to look at the message portal and the token bridge. For the most part, cross-chain messaging protocols work very similar. The general procedure is that there is a singleton smart contract on the sending chain (Ethereum) dedicated to emitting arbitrary messages. Protocol validators listen to these messages and then broadcasted them to the receiving chain.\n\nThe message can be relayed through a smart contract on the receiving chain, but often is also relayed by a very specific address (e.g. the zero address on Polygon) or an aliased address (e.g. Arbitrum, Optimism add a fixed offset to any message sender's address).\n\nAs transmitting messages is often left very general, the specifics of a cross-chain token bridge require additional logic and validation.\n\nIn the case of Fuel\n\n# General Token Bridge Design\n\n```mermaid\nflowchart LR;\n    Validators([Validators])\n    Validators -.-\u003e|relay msg| PortalReceiver;\n    subgraph Fuel\n      PortalReceiver -.-\u003e|call| receiver;\n    end\n\n    User([User])\n    User -.-\u003e|send tx| PortalSender;\n    subgraph Ethereum\n      PortalSender -.-\u003e|emit msg| PortalSender;\n    end\n```\n\nIgnoring other transaction message values such as `gas`, `gasLimit`, `value` and nonce validation.\n\n```mermaid\nclassDiagram\n    class Message {\n        address sender\n        address receiver\n        bytes data\n    }\n```\n\nA token bridge requires extra validation logic to be handled by a `TokenBridgeSender` and a `TokenBridgeReceiver` contract.\n\n```mermaid\nflowchart LR;\n    Validators([Validators])\n    Validators -.-\u003e|relay msg| PortalReceiver;\n    subgraph Fuel\n      PortalReceiver --\u003e|call| TokenBridgeReceiver;\n      TokenBridgeReceiver -.-\u003e|transfer token| receiver;\n    end\n\n    User([User])\n    User -.-\u003e|send tx| TokenBridgeSender;\n    subgraph Ethereum\n      TokenBridgeSender --\u003e|call| PortalSender;\n      PortalSender -.-\u003e|emit msg| PortalSender;\n    end\n```\n\n```mermaid\nclassDiagram\n    class Message {\n        address sender : TokenBridgeSender\n        address receiver :  TokenBridgeReceiver\n        bytes data : enc(user, receiver, token, value)\n    }\n```\n","title":"Fuel message portal","date":"Dec 28, 2023","suptitle":null}},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["unpublished","fuel-message"]},"buildId":"AocSisQRIhnO2ZxvvO6f8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>